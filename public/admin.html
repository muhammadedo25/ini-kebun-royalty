<!DOCTYPE html>
<html>
<head>
  <title>Admin Ini Kebun</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body { font-family: system-ui; padding: 20px; background:#f9f9f9 }
    h1 { margin-bottom: 20px; }
    .box { padding: 16px; border-radius: 12px; background: #f3f3f3; margin-bottom: 12px }
    table { width: 100%; border-collapse: collapse; margin-top: 12px; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
    th { background: #eee; }
  </style>
</head>
<body>

<h1>ğŸ“Š Dashboard Ini Kebun</h1>

<div class="box">ğŸ‘¥ Total Pengunjung: <b id="visitors">-</b></div>
<div class="box">ğŸ“¸ Total Scan: <b id="scans">-</b></div>

<h3>ğŸ§ Daftar Pengunjung</h3>
<table>
  <thead>
    <tr>
      <th>Nama Visitor</th>
      <th>Total Visit</th>
      <th>Pertama Datang</th>
    </tr>
  </thead>
  <tbody id="visitorList"></tbody>
</table>

<h3>ğŸ•’ Scan Terakhir</h3>
<ul id="list"></ul>

<script>
fetch('/api/admin-stats')
  .then(res => res.json())
  .then(data => {
    document.getElementById('visitors').innerText = data.totalVisitors
    document.getElementById('scans').innerText = data.totalScans

    // Daftar visitor
    const tbody = document.getElementById('visitorList')
    tbody.innerHTML = '' // bersihkan dulu
    data.visitors.forEach(v => {
      const visitorName = v.name || 'Anonim'
      const tr = document.createElement('tr')
      tr.innerHTML = `
        <td>${visitorName}</td>
        <td>${v.total_visit}</td>
        <td>${new Date(v.created_at).toLocaleDateString()}</td>
      `
      tbody.appendChild(tr)
    })

    // Daftar scan terakhir
    const list = document.getElementById('list')
    list.innerHTML = '' // bersihkan dulu
    data.latest.forEach(item => {
      const li = document.createElement('li')
      li.innerText = `${item.outlet_code} â€” ${new Date(item.created_at).toLocaleString()}`
      list.appendChild(li)
    })
  })
  .catch(err => console.error('Error fetch admin-stats:', err))

</script>

</body>
</html>
